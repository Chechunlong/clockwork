# Copyright (C) 2012 Martin Leadbeater, Michael O'Connor
# 
# This file is part of Latproc
#
# Latproc is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# 
# Latproc is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with Latproc; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
# 

base VARIABLE (tab:Test) 20; 
length CONSTANT (tab:Test) 12; 

total VARIABLE (tab:Test) 1;
each VARIABLE (tab:Test) 0;
last VARIABLE (tab:Test) 0;

Calculator MACHINE {
    GLOBAL total, each, base, length;
    GLOBAL last;

    stable WHEN total.VALUE == last.VALUE;
    recalculate DEFAULT;
    
    ENTER stable { LOG "stable"; }

    ENTER recalculate {
		tmp := 0;
        IF (total > 6) {
            tmp := base / total;
           IF (base % total != 0) { tmp := tmp + 1; };
        };  
        IF (total <= 6) {
           tmp := (length / total);
           IF (length % total != 0) { tmp := tmp + 1; };
        };  
        each := tmp;
        last := total;   
        LOG "recalculated";
    }   

}

calc Calculator (tab:Test);

Counter MACHINE {
    GLOBAL total;
    GLOBAL last;

    idle DEFAULT;
    working WHEN total.VALUE != last.VALUE;
    ENTER idle { total := total + 1; }
    ENTER working { LOG "working"; }
}
counter Counter(tab:Test);

